@model TravelCleanArch.Web.Areas.Admin.Models.ExpeditionFormViewModel
@{ var postUrl = (string?)ViewBag.PostUrl ?? "/admin/expeditions/create/includes-excludes"; if (!Model.CostItems.Any()) { Model.CostItems.Add(new()); } }
<div class="container-fluid">
    <h3 class="mb-3">Expedition - Includes / Excludes</h3>
    <partial name="~/Areas/Admin/Views/Expeditions/Steps/_StepTabs.cshtml" />
    <form method="post" enctype="multipart/form-data" action="@postUrl">
        @Html.AntiForgeryToken()
        @if (Model.Id.HasValue) { <input type="hidden" asp-for="Id" /> }
        <input type="hidden" name="step" value="3" /><input type="hidden" name="intent" id="intent" value="stay" />
        <div id="costWrap">
            @for (var i = 0; i < Model.CostItems.Count; i++)
            {
                <div class="row g-2 mb-2 cost-row">
                    <input type="hidden" asp-for="CostItems[i].Id" />
                    <div class="col-md-2"><select asp-for="CostItems[i].Type" class="form-select"><option>Inclusion</option><option>Exclusion</option></select></div>
                    <div class="col-md-4"><input asp-for="CostItems[i].Title" class="form-control" placeholder="Title" /></div>
                    <div class="col-md-6"><input asp-for="CostItems[i].ShortDescription" class="form-control" placeholder="Short description" /></div>
                </div>
            }
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addCost()">Add Row</button>
        <div class="mt-3 d-flex gap-2">
            <button type="submit" class="btn btn-success" onclick="document.getElementById('intent').value='stay'">Save Changes</button>
            <button type="submit" class="btn btn-primary" onclick="document.getElementById('intent').value='next'">Save & Next</button>
        </div>
    </form>
</div>
@section Scripts {
<script>
function addCost(){
 const wrap=document.getElementById('costWrap');const i=wrap.querySelectorAll('.cost-row').length;
 wrap.insertAdjacentHTML('beforeend',`<div class="row g-2 mb-2 cost-row"><input type="hidden" name="CostItems[${i}].Id" value="0" /><div class="col-md-2"><select name="CostItems[${i}].Type" class="form-select"><option>Inclusion</option><option>Exclusion</option></select></div><div class="col-md-4"><input name="CostItems[${i}].Title" class="form-control" /></div><div class="col-md-6"><input name="CostItems[${i}].ShortDescription" class="form-control" /></div></div>`);
}
</script>
}
